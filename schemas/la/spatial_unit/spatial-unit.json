{
	"$schema": "https://json-schema.org/draft/2020-12/schema",
	"$id": "https://raw.githubusercontent.com/svranic/ladm-schemas/main/schemas/la/spatial_unit/spatial-unit.json",
	"title": "LADM LA_SpatialUnit Profile (JSON-FG)",
	"description": "Implementation of LADM Spatial Unit package extending OGC Features and Geometries JSON",
	"allOf": [
		{
			"$comment": "1. INHERITANCE: Extends the official OGC JSON-FG Feature Schema",
			"$ref": "https://beta.schemas.opengis.net/json-fg/feature.json"
		},
		{
			"$comment": "2. INHERITANCE: Extends LADM VersionedObject (Relative path to core)",
			"$ref": "../core/versioned-object.json#/$defs/VersionedObject"
		},
		{
			"$comment": "3. CONSTRAINTS & EXTENSIONS: Spatial Unit specific properties",
			"type": "object",
			"properties": {
				"type": {
					"const": "Feature"
				},
				"featureType": {
					"const": "LA_SpatialUnit",
					"description": "Discriminator to identify this as a Cadastral Spatial Unit"
				},
				"coordRefSys": {
					"description": "Default CRS for the 'place' geometry (e.g., EPSG:3765)",
					"type": "string",
					"default": "urn:ogc:def:crs:EPSG::3765"
				},
				"properties": {
					"type": "object",
					"required": [
						"suID",
						"dimension",
						"area"
					],
					"properties": {
						"suID": {
							"description": "LADM Oid (Namespace + LocalId)",
							"type": "string"
						},
						"label": {
							"description": "Cartographic label (e.g. parcel number '123/1')",
							"type": "string"
						},
						"dimension": {
							"description": "LA_DimensionType",
							"type": "string",
							"enum": [
								"0D",
								"1D",
								"2D",
								"3D",
								"liminal"
							]
						},
						"area": {
							"description": "LA_AreaValue [0..*]",
							"type": "array",
							"items": {
								"$ref": "#/$defs/LA_AreaValue"
							},
							"minItems": 1
						},
						"referencePoint": {
							"description": "LA_SpatialUnit reference point",
							"$ref": "https://beta.schemas.opengis.net/json-fg/geometry-object#/$defs/Point"
						},
						"landUse": {
							"description": "Reference to Land Use CodeList (e.g. SKOS concept)",
							"$ref": "../core/datatypes.json#/$defs/CodeListRef"
						},
						"spatialSource": {
							"description": "Reference to LA_SpatialSource (Survey/Document)",
							"type": "array",
							"items": {
								"$ref": "#/$defs/SourceRef"
							}
						}
					}
				}
			},
			"required": [
				"type",
				"featureType",
				"place",
				"properties"
			]
		},
		{
      "$comment": "--- RULE: 2D DIMENSION ENFORCEMENT ---",
      "if": {
        "properties": {
          "properties": {
            "properties": {
              "dimension": { "const": "2D" }
            }
          }
        }
      },
      "then": {
        "properties": {
          "place": {
            "type": "object",
            "required": ["type"],
            "properties": {
              "type": {
                "description": "If dimension is 2D, only flat geometries are allowed.",
                "type": "string",
                "enum": [
                  "Point", "MultiPoint", 
                  "LineString", "MultiLineString", 
                  "Polygon", "MultiPolygon"
                ]
              }
            }
          }
        }
      }
    },
    
    {
      "$comment": "--- RULE: 3D DIMENSION ENFORCEMENT ---",
      "if": {
        "properties": {
          "properties": {
            "properties": {
              "dimension": { "const": "3D" }
            }
          }
        }
      },
      "then": {
        "properties": {
          "place": {
            "type": "object",
            "required": ["type"],
            "properties": {
              "type": {
                "description": "If dimension is 3D, only volumetric geometries are allowed.",
                "type": "string",
                "enum": [
                  "Polyhedron", 
                  "MultiPolyhedron", 
                  "Prism", 
                  "MultiPrism"
                ]
              }
            }
          }
        }
      }
    }
	],
	"$defs": {
		"LA_AreaValue": {
			"type": "object",
			"description": "Structured Area with UCUM units",
			"properties": {
				"measurement": {
					"type": "number",
					"exclusiveMinimum": 0
				},
				"type": {
					"type": "string",
					"enum": [
						"officialArea",
						"calculatedArea",
						"surveyedArea"
					],
					"default": "officialArea"
				},
				"uom": {
					"type": "string",
					"description": "Unified Code for Units of Measure (UCUM)",
					"enum": [
						"m2",
						"har",
						"km2"
					],
					"default": "m2"
				}
			},
			"required": [
				"measurement",
				"type",
				"uom"
			]
		},
		"SourceRef": {
			"description": "Reference to an LA_SpatialSource",
			"oneOf": [
				{
					"type": "string",
					"format": "uri"
				},
				{
					"type": "object",
					"properties": {
						"sourceID": {
							"type": "string"
						}
					},
					"required": [
						"sourceID"
					]
				}
			]
		}
	}
}